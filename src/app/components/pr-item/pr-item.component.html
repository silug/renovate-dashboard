<div class="p-4 border-b border-gray-600 last:border-b-0 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
  <!-- PR Info & Checks Container -->
  <div class="flex-1 min-w-0">
    <!-- PR Info -->
    <div class="flex items-start space-x-3">
      <button type="button" class="flex items-center space-x-3 text-left" (click)="onToggleExpanded()" [attr.aria-expanded]="expanded">
        <svg class="w-5 h-5 text-gray-400 transition-transform duration-200" [class.rotate-90]="expanded" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M6 4a1 1 0 011.707-.707l6 6a1 1 0 010 1.414l-6 6A1 1 0 016 16V4z" clip-rule="evenodd" />
        </svg>
        <span [innerHTML]="getCIStatusIcon(pr.ciStatus)" class="flex-shrink-0 mt-0.5"></span>
      </button>
      <span [innerHTML]="getWorkflowStatusIcon(pr.workflowStatus)" class="flex-shrink-0 mt-0.5"></span>
      <div class="min-w-0">
        <a [href]="pr.html_url" target="_blank" class="font-mono text-sm text-blue-400 hover:underline truncate block">
          {{ pr.repoOwner }}/{{ pr.repoName }}#{{ pr.number }}
        </a>
        @if(pr.isModified) {
          <div class="flex items-center mt-1">
            <span class="text-xs bg-yellow-900/80 text-yellow-300 font-semibold px-2 py-0.5 rounded-full flex items-center gap-1">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" /></svg>
              User Modified
            </span>
          </div>
        }
      </div>
    </div>
    <!-- Check Runs List -->
  @if(expanded && pr.checkRuns.length > 0) {
      <div class="pt-2 pl-9"> <!-- Aligned with PR title -->
        <div class="space-y-2">
          @for(check of pr.checkRuns; track check.name) {
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-sm text-gray-300 bg-gray-700/40 border border-gray-600/70 rounded-md px-3 py-2">
            <a [href]="check.html_url" target="_blank" class="flex items-center gap-2 hover:text-white transition-colors duration-200 group">
              <span class="group-hover:underline">{{ check.name }}</span>
              <svg class="w-4 h-4 text-gray-400 group-hover:text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5h8v14H5z" /></svg>
            </a>
            <div class="flex items-center gap-4 text-xs text-gray-400">
              <span class="flex items-center gap-1">
                <span [innerHTML]="getCheckRunStatusIcon(check.status)"></span>
                <span>{{ formatStatus(check.status) }}</span>
              </span>
              <span class="flex items-center gap-1" *ngIf="check.conclusion">
                <span [innerHTML]="getCheckRunConclusionIcon(check.conclusion)"></span>
                <span>{{ formatConclusion(check.conclusion) }}</span>
              </span>
              <span class="flex items-center gap-1" *ngIf="!check.conclusion">
                <span class="text-yellow-400">‚è≥</span>
                <span>Awaiting conclusion</span>
              </span>
            </div>
          </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Action Buttons -->
  <div class="flex items-center justify-end space-x-2 flex-shrink-0">
    <button 
      (click)="onClosePr()" 
      [disabled]="pr.isProcessing" 
      class="action-button bg-red-800 hover:bg-red-700 disabled:bg-gray-600 px-3 py-2 text-sm font-medium text-white rounded-md transition-colors duration-200 disabled:cursor-not-allowed"
    >
       @if(pr.isProcessing) { 
         <span class="spinner-small inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span> 
       } @else { 
         <span>Close</span> 
       }
    </button>
    <button 
      (click)="onApproveAndMergePr()" 
      [disabled]="pr.isProcessing" 
      class="action-button bg-green-800 hover:bg-green-700 disabled:bg-gray-600 px-3 py-2 text-sm font-medium text-white rounded-md transition-colors duration-200 disabled:cursor-not-allowed"
    >
       @if(pr.isProcessing) { 
         <span class="spinner-small inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span> 
       } @else { 
         <span>Approve & Merge</span> 
       }
    </button>
  </div>
</div>
